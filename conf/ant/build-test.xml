<project name="Genyris-Test" basedir="../../">

    <target name="-test-init">
        <echo message="Preparing test directories" />
        <mkdir dir="${test.reports.dir}" />
        <mkdir dir="${test.compile.dir}" />
        <mkdir dir="${test.results.dir}" />
    </target>

    <!-- =================================================================== -->
    <!-- In order to run a single test case, run the Ant with the command    -->
    <!-- line like: ant test -Dtestcase=<fully qualified classname>          -->
    <!-- =================================================================== -->
    <target name="-unit-test">

        <run-unit-tests classpathref="test.classpath" fail.prop="test.failed" />
        <fail if="test.failed">
        Unit tests failed. For error messages, check the log files in
        ${test.results.dir} or run "ant test-reports"
        to generate reports at ${test.reports.dir}.</fail>
    </target>


    <target name="-test-reports">
        <junitreport todir="${test.results.dir}">
            <fileset dir="${test.results.dir}">
                <include name="TEST-*.xml" />
            </fileset>
            <report format="frames" styledir="${test.styles.dir}" todir="${test.reports.dir}" />
        </junitreport>
        <echo level="info">
        Test reports generated at ${test.reports.dir}
      </echo>
    </target>


    <macrodef name="run-unit-tests">
        <attribute name="classpathref" />
        <attribute name="fail.prop" default="dont.care" />
        <sequential>
            <pathconvert dirsep="\\" property="lib.path">
                <path location="${testlib.dir}/binary" />
            </pathconvert>
            <junit dir="${basedir}" fork="${test.fork}" printsummary="true" errorProperty="@{fail.prop}" failureProperty="@{fail.prop}">
                <sysproperty key="java.library.path" path="${lib.path}" />
                <classpath refid="@{classpathref}" />
                <formatter type="brief" usefile="false" />
                <formatter type="xml" />
                <test name="${testcase}" todir="${test.results.dir}" if="testcase" />
                <batchtest todir="${test.results.dir}" unless="testcase">
                    <fileset refid="unit.test.class.files" />
                </batchtest>
            </junit>
        </sequential>
    </macrodef>

</project>
